---
import { Calendar, MapPin, ArrowRight } from "lucide-astro";
import {
    getLocalizedText,
    useTranslations,
    getLocalizedPath,
} from "../i18n/utils";
import type { Itinerary, Place, Language } from "../types";

interface Props {
    itinerary: Itinerary;
    places: Place[];
    lang: Language;
}

const { itinerary, places, lang } = Astro.props;
const t = useTranslations(lang);

const title = getLocalizedText(itinerary.title, lang);
const description = getLocalizedText(itinerary.description, lang);
const duration = getLocalizedText(itinerary.duration, lang);

// Get places included in this itinerary
const itineraryPlaces = itinerary.stops
    .map((stop) => places.find((p) => p.id === stop.placeId))
    .filter(Boolean) as Place[];

const difficultyLabel = t(
    "itineraries",
    "difficultyLevels",
    itinerary.difficulty,
);

const difficultyColor = {
    easy: "bg-green-100 text-green-800",
    moderate: "bg-yellow-100 text-yellow-800",
    challenging: "bg-red-100 text-red-800",
}[itinerary.difficulty];
---

<article class="card">
    <a
        href={getLocalizedPath(`/itineraries/${itinerary.slug}`, lang)}
        class="block p-6"
    >
        <!-- Header -->
        <div class="flex items-start justify-between mb-4">
            <div>
                <h3
                    class="font-semibold text-lg text-gray-900 group-hover:text-primary-600 transition-colors"
                >
                    {title}
                </h3>
                <div class="flex items-center gap-4 mt-2 text-sm text-gray-500">
                    <span class="flex items-center gap-1">
                        <Calendar class="w-4 h-4" />
                        {duration}
                    </span>
                    <span class="flex items-center gap-1">
                        <MapPin class="w-4 h-4" />
                        {itinerary.stops.length}
                        {t("itineraries", "stops")}
                    </span>
                </div>
            </div>
            <span class:list={["badge", difficultyColor]}>
                {difficultyLabel}
            </span>
        </div>

        <!-- Description -->
        <p class="text-gray-600 text-sm mb-4 line-clamp-2">
            {description}
        </p>

        <!-- Places Preview -->
        <div class="flex items-center gap-2 flex-wrap">
            {
                itineraryPlaces.slice(0, 3).map((place, idx) => (
                    <>
                        <span class="text-sm text-gray-700">
                            {getLocalizedText(place.name, lang)}
                        </span>
                        {idx < Math.min(itineraryPlaces.length, 3) - 1 && (
                            <ArrowRight class="w-3 h-3 text-gray-400" />
                        )}
                    </>
                ))
            }
            {
                itineraryPlaces.length > 3 && (
                    <span class="text-sm text-gray-500">
                        +{itineraryPlaces.length - 3}
                    </span>
                )
            }
        </div>
    </a>
</article>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
